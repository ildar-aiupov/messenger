## Проект Messenger service

Messenger service - API-сервис на базе Django, DRF, Celery и Django-celery-beat для управления рассылками сообщений по заданному расписанию и получения статистики по выполненным рассылкам.
Автор проекта: Ильдар Аюпов, 2024 г., e-mail: ildarbon@gmail.com, Telegramm: @ildarbonn

### Техническое описание проекта:

Основные библиотеки и технологии:
- Бэкенд: Python, Django, DRF, Celery, Django-celery-beat, DRF-spectacular, PostgreSQL, Redis
- Деплой: Docker, Docker compose, NGINX, Gunicorn

Реализованы такие вещи, как:
- задание расписания рассылок
- организована ежесуточная автоматическая отправка статистики по обработанным рассылкам на email
- обработка АПИ запросов, валидация входящих данных, пагинация статистической информации
- автоматическая генерация и ручная донастройка документации АПИ через DRF-spectacular
- автоматическое воссоздание начальных данных из дампа PostgreSQL при развертывании сервиса
- подробное логирование значимых событий
- обработка возможных ошибок, обеспечение стабильности рассылки через механизм backoff
- контейнеризация сервисов в оркестре контейнеров, раздача через Nginx
- настройка админ-панели Django для работы с моделями
- версионирование API

Описание логики рассылок:
- отправка сообщений производится на эндпоинт внешнего API с использованием аутентификации по JWT-токену
- после создания новой рассылки, если текущее время больше времени начала и меньше времени окончания, из базы выбираются все клиенты, которые подходят под значения фильтра, указанного в этой рассылке, и запускается отправка для этих клиентов
- если создаётся рассылка с временем старта в будущем, то отправка стартует автоматически по наступлению этого времени без дополнительных действий со стороны пользователя системы
- по ходу отправки сообщений собирается статистика по каждому сообщению для последующего формирования отчётов
- учитывая, что внешний сервис, который принимает отправляемые сообщения, теоретически может долго обрабатывать запрос, отвечать некорректными данными, на какое-то время вообще не принимать запросы, в настоящем сервисе реализована обработка подобных ошибок, откладывание запросов для последующей повторной отправки. Проблемы с внешним сервисом не влияют на стабильность работы настоящего сервиса рассылок

### Развернуть проект на локальной машине:

- Установить Docker, Docker Compose:
```
sudo apt update
sudo apt install curl
curl -fSL https://get.docker.com -o get-docker.sh
sudo sh ./get-docker.sh
sudo apt-get install docker-compose-plugin
```

- Клонировать репозиторий:
```
git clone git@github.com:ildar-aiupov/messenger.git
```

- В корневой папке проекта переименовать файл ```.env.example``` в файл ```.env```. Для работы сервиса необходимо задать в файле настроек токен доступа к внешнему API, а также параметры электронной почты для ежесуточной отправки статистической информации

- Находясь в корневой папке проекта, запустить его сборку:
```
sudo docker compose up -d
```

- При сборке проекта для демонстрации его работы сразу автоматически создается база данных с выполненными миграциями Джанго, суперпользователем (логин admin, пароль admin), тремя тэгами (users, staff, admins) и тремя мобильными операторами (Megafon, MTS, Beeline).

- Точки входа в проект:
```
Админ-панель: http://localhost/admin/
Подробное описание АПИ через SWAGGER UI: http://localhost/docs/
Эндпоинты: 
[POST] http://localhost/api/v1/clients/
[PUT, DELETE] http://localhost/api/v1/clients/{id}

[POST] http://localhost/api/v1/mailings/
[PUT, DELETE] http://localhost/api/v1/mailings/{id}

[GET] http://localhost/api/v1/mailings/info/
[GET] http://localhost/api/v1/mailings/info/{id}/
```

- Для остановки контейнеров Docker:
```
sudo docker compose down -v      # с их удалением (также удаляются все хранилища данных проекта)
sudo docker compose stop         # просто остановка без удаления
```
